<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Grille ‚Äì WordBomb Helper</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#0b0f14;
  color:#e6edf3;
  display:flex;
  min-height:100vh;
}


.sidebar {
  width:220px;
  background:#070b10;
  border-right:1px solid #111;
  display:flex;
  flex-direction:column;
  padding-top:20px;
}

.sidebar h2 {
  color:#7bc8ff;
  text-align:center;
  margin-bottom:20px;
}

.sidebar a {
  text-decoration:none;
  color:#e6edf3;
  padding:12px 20px;
  margin:5px;
  border-radius:10px;
  transition:0.2s;
  background:#13374a;
  text-align:center;
  font-weight:bold;
}

.sidebar a:hover {
  background:#18506a;
  transform:translateY(-2px);
}


.main {
  flex:1;
  padding:30px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

header {
  background:#070b10;
  padding:16px;
  width:100%;
  margin-bottom:20px;
  border-bottom:1px solid #111;
  text-align:center;
}

header h1 { color:#7bc8ff; margin:0; }

.container {
  display:flex;
  gap:20px;
  width:100%;
  justify-content:center;
}

#grid {
  background:#0f1923;
  padding:10px;
  border-radius:8px;
  border:1px solid #1b2a33;
  min-width:560px;
}

table { border-collapse:collapse; }
td {
  width:40px; height:26px; text-align:center;
  border:1px solid #1b2a33;
  background:#0f1a24;
  font-weight:bold;
  font-size:13px;
  color:white;
}
td.empty { color:#1a2f3a; }

.panel {
  background:#0f1a24;
  padding:16px;
  border-radius:8px;
  border:1px solid #1b2a33;
  width:300px;
}

textarea,input {
  width:100%;
  background:#09131d;
  border:1px solid #1b2a33;
  color:#e6edf3;
  padding:8px;
  border-radius:6px;
  margin-top:6px;
}

button {
  width:100%;
  padding:10px;
  margin-top:8px;
  background:#13374a;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}
button:hover { background:#18506a; }

#usedBox {
  margin-top:20px;
  background:#0f1a24;
  padding:16px;
  border-radius:8px;
  border:1px solid #1b2a33;
  font-family:monospace;
  white-space:pre-wrap;
  line-height:1.4em;
}

.wordTitle { font-weight:bold; color:#7bc8ff; }
.syllLine { margin-left:10px; color:#c0e0ff; }
</style>
</head>
<body>

<div class="sidebar">
  <h2>Menu</h2>
  <a href="index.html">Accueil</a>
  <a href="grille.html">Grille</a>
  <a href="sub1.html">SUB1</a>
  <a href="all.html">All</a>
  <a href="json.html">JSON</a>
  <a href="helper.html">Helper</a>
  <a href="dictionnaire.html">Dictionnaires</a>
</div>

<div class="main">
<header><h1>Grille</h1></header>

<div class="container">
  <div id="grid"></div>

  <div class="panel">
    <h2>Syllabes JSON</h2>
    <textarea id="syllTxt" rows="12">{ }</textarea>

    <h2>Chargez votre dico !</h2>
    <input type="file" id="frInput" accept="text/plain">

    <h2>Nombre de mots</h2>
    <input id="maxWords" type="number" value="30">

    <button id="btnSearch">üîç SEARCH</button>

    <h2>Modifier la grille</h2>
    <input id="gridW" type="number" value="24" placeholder="Largeur">
    <input id="gridH" type="number" value="24" placeholder="Hauteur">
  </div>
</div>

<div id="usedBox">Aucun mot plac√© pour l‚Äôinstant.</div>
</div>

<script>
let words = [];
let GRID_W = 24;
let GRID_H = 24;
let grid = [];
let usedData = [];

function initGrid(){
  grid = Array.from({length:GRID_H},()=>Array(GRID_W).fill(""));
  usedData = [];
  updateUsedBox();
  renderGrid();
}

function renderGrid(){
  let html = "<table>";
  for(let r=0;r<GRID_H;r++){
    html += "<tr>";
    for(let c=0;c<GRID_W;c++){
      let v = grid[r][c];
      html += v==="" ? `<td class='empty'>.</td>` : `<td>${v}</td>`;
    }
    html += "</tr>";
  }
  html += "</table>";
  document.getElementById("grid").innerHTML = html;
}

function parseSyllables(){
  try{ return JSON.parse(document.getElementById("syllTxt").value); }
  catch(e){ alert("JSON syllabes invalide"); return {}; }
}

function saveSyllables(obj){
  document.getElementById("syllTxt").value = JSON.stringify(obj,null,2);
}

function assignSyllables(word, stock){
  let temp = structuredClone(stock);
  let i=0, out=[];
  while(i<word.length){
    let found=false;
    for(let L=3;L>0;L--){
      if(i+L>word.length) continue;
      let cand = word.substring(i,i+L);
      if(temp[cand] && temp[cand] > 0){
        out.push(cand);
        temp[cand]--;
        i += L;
        found = true;
        break;
      }
    }
    if(!found) return null;
  }
  return out;
}

function consume(seg, stock){
  for(let s of seg){ stock[s]--; }
}

function updateUsedBox(){
  if(usedData.length === 0){
    document.getElementById("usedBox").textContent = "Aucun mot plac√© pour l‚Äôinstant.";
    return;
  }
  let txt = "";
  for(let obj of usedData){
    txt += `\n<span class="wordTitle">${obj.word}</span>\n`;
    txt += `<span class="syllLine">‚Üí ${obj.seg.join(" | ")}</span>\n`;
  }
  document.getElementById("usedBox").innerHTML = txt;
}

function canPlaceRow(row, seg){
  if(seg.length > GRID_W) return false;
  for(let c=0;c<seg.length;c++){
    if(grid[row][c] !== "") return false;
  }
  return true;
}

function placeRow(row, seg){
  for(let c=0;c<seg.length;c++){
    grid[row][c] = seg[c];
  }
}

function placeWords(n){
  GRID_W = parseInt(document.getElementById("gridW").value);
  GRID_H = parseInt(document.getElementById("gridH").value);
  initGrid();
  let stock = parseSyllables();
  let list = words.filter(w=>w.length<=50).sort((a,b)=>b.length-a.length);
  let row=0, placed=0;
  for(let w of list){
    if(placed>=n || row>=GRID_H) break;
    if(usedData.some(u=>u.word === w)) continue;
    let seg = assignSyllables(w, stock);
    if(!seg) continue;
    if(canPlaceRow(row, seg)){
      placeRow(row, seg);
      consume(seg, stock);
      saveSyllables(stock);
      usedData.push({word: w, seg: seg});
      updateUsedBox();
      row++;
      placed++;
    }
  }
  renderGrid();
  alert(placed + " mots plac√©s !");
}

document.getElementById("frInput").addEventListener("change", async e=>{
  let file=e.target.files[0]; if(!file) return;
  let txt = await file.text();
  words = txt.split(/\r?\n/).map(w=>w.trim().toUpperCase()).filter(w=>w.length);
  alert("FR.txt charg√© : "+words.length+" mots");
});

document.getElementById("btnSearch").addEventListener("click", ()=>{
  if(!words.length){ alert("Charge FR.txt"); return; }
  let n = parseInt(document.getElementById("maxWords").value);
  placeWords(n);
});

initGrid();
</script>

</body>
</html>
