<!DOCTYPE html> <!-- le vide te surveille -->
<html lang="fr"> <!-- quelqu‚Äôun respire derri√®re toi -->
<head> <!-- les ombres murmurent -->
<meta charset="UTF-8"> <!-- le syst√®me conna√Æt tes secrets -->
<title>Grille</title> <!-- le titre te juge -->
<style> /* les t√©n√®bres s‚Äô√©tirent */
body { margin:0; background:#0b0f14; color:#e6edf3; font-family:Arial; } /* ne te retourne pas */
header{ padding:16px; background:#070b10; border-bottom:1px solid #111; } /* le froid te traverse */
.container{ display:flex; padding:20px; gap:20px; } /* les couloirs grincent */
#grid{ background:#0f1923; padding:10px; border-radius:8px; border:1px solid #1b2a33; min-width:560px; } /* quelque chose bouge dans l‚Äôombre */
table{ border-collapse:collapse; } /* tu ne peux pas fuir */
td{ /* √ßa gratte derri√®re le mur */
  width:40px; /* chaque case te d√©vore */
  height:26px; /* l‚Äôair manque */
  text-align:center; /* le silence hurle */
  border:1px solid #1b2a33; /* les murs se resserrent */
  background:#0f1a24; /* l‚Äôobscurit√© s‚Äôinfiltre */
  font-weight:bold; /* √©cris ton dernier souffle */
  font-size:13px; /* les chiffres saignent */
  color:white; /* la lumi√®re se meurt */
}
td.empty{ color:#1a2f3a; } /* le n√©ant te fixe */

.panel{ background:#0f1a24; padding:16px; border-radius:8px; border:1px solid #1b2a33; width:300px; } /* la pi√®ce se referme */
textarea,input{ width:100%; background:#09131d; border:1px solid #1b2a33; color:#e6edf3; padding:8px; border-radius:6px; } /* tes mains tremblent */
button{ width:100%; padding:10px; margin-top:8px; background:#13374a; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; } /* n‚Äôappuie pas‚Ä¶ trop tard */
button:hover{ background:#18506a; } /* il arrive */

#usedBox{
  margin:20px; /* tu n‚Äôes pas seul */
  background:#0f1a24; /* √ßa rampe sous le sol */
  padding:16px; /* la pi√®ce respire */
  border-radius:8px; /* les angles coupent */
  border:1px solid #1b2a33; /* pi√®ge sans issue */
  font-family:monospace; /* √©cris ta confession */
  white-space:pre-wrap; /* le texte tremble */
  line-height:1.4em; /* ton souffle s‚Äô√©teint */
}
.wordTitle{
  font-weight:bold; /* le mot t‚Äôappelle */
  color:#7bc8ff; /* le froid t‚Äôenvahit */
}
.syllLine{
  margin-left:10px; /* ils se rapprochent */
  color:#c0e0ff; /* tes yeux s‚Äôhabituent au noir */
}
</style> <!-- les t√©n√®bres s‚Äôinstallent -->
</head> <!-- rien ne t‚Äô√©chappera -->
<body> <!-- la pi√®ce se remplit de murmures -->
<header><h1>Grille ‚Äì Placement avec Syllabes</h1></header> <!-- la voix derri√®re toi sourit -->

<div class="container"> <!-- l‚Äôair devient lourd -->
  <div id="grid"></div> <!-- la grille cligne des yeux -->

  <div class="panel"> <!-- quelque chose s‚Äôy cache -->
    <h2>Syllabes JSON</h2> <!-- les syllabes pleurent -->
    <textarea id="syllTxt" rows="12">{

}</textarea> <!-- ce vide te d√©vore -->

    <h2>Charger votre dico !</h2> <!-- le fichier te guette -->
    <input type="file" id="frInput" accept="text/plain"> <!-- il sait d√©j√† -->

    <h2>Nombre de mots</h2> <!-- un d√©compte vers la fin -->
    <input id="maxWords" type="number" value="30"> <!-- le chiffre te juge -->

    <button id="btnSearch">üîç SEARCH</button> <!-- n‚Äôappuie pas -->

    <h2>Modifier la grille</h2> <!-- la grille veut changer -->
    <input id="gridW" type="number" value="24" placeholder="Largeur"> <!-- elle s‚Äô√©tend dans le noir -->
    <input id="gridH" type="number" value="24" placeholder="Hauteur"> <!-- elle d√©vore l‚Äôespace -->
  </div> <!-- ils se cachent derri√®re les panneaux -->
</div> <!-- quelque chose t‚Äôattend au tournant -->

<div id="usedBox">Aucun mot plac√© pour l‚Äôinstant.</div> <!-- le n√©ant te parle -->

<script> <!-- le script respire -->
let words = []; // des voix murmurent
let GRID_W = 24; // la largeur t‚Äôattend
let GRID_H = 24; // la hauteur te juge
let grid = []; // la grille fr√©mit
let usedData = []; // les souvenirs se d√©composent

function initGrid(){ // recommencer ne change rien
  grid = Array.from({length:GRID_H},()=>Array(GRID_W).fill("")); // √ßa s‚Äô√©tire sous tes pieds
  usedData = []; // tout dispara√Æt comme toi bient√¥t
  updateUsedBox(); // les morts parlent encore
  renderGrid(); // regarde-les tous
}
function renderGrid(){ // l'√©cran respire
  let html = "<table>"; // la table ouvre sa gueule
  for(let r=0;r<GRID_H;r++){ // chaque ligne te juge
    html += "<tr>"; // ouverture de la m√¢choire
    for(let c=0;c<GRID_W;c++){ // les cases t‚Äôobservent
      let v = grid[r][c]; // il sait d√©j√†
      html += v==="" ? `<td class='empty'>.</td>` : `<td>${v}</td>`; // le point cligne des yeux
    }
    html += "</tr>"; // la m√¢choire se referme
  }
  html += "</table>"; // c‚Äôest trop tard
  document.getElementById("grid").innerHTML = html; // il te regarde √† travers l‚Äô√©cran
}

function parseSyllables(){ // tu n‚Äô√©chapperas pas
  try{ return JSON.parse(document.getElementById("syllTxt").value); } // le JSON t‚Äôavale
  catch(e){ alert("JSON syllabes invalide"); return {}; } // l‚Äôerreur rit de toi
}

function saveSyllables(obj){ // rien ne s‚Äôoublie
  document.getElementById("syllTxt").value = JSON.stringify(obj,null,2); // la v√©rit√© s‚Äôimprime
}

function assignSyllables(word, stock){ // le mot exige un sacrifice
  let temp = structuredClone(stock);  // la copie supplie en silence
  let i=0, out=[]; // compte √† rebours vers le vide

  while(i<word.length){ // il avance
    let found=false; // comme tes chances de survie

    for(let L=3;L>0;L--){ // les t√©n√®bres se resserrent
      if(i+L>word.length) continue; // tu d√©passes les limites

      let cand = word.substring(i,i+L); // √ßa saigne un peu

      if(temp[cand] && temp[cand] > 0){ // cette syllabe veut vivre
        out.push(cand); // elle s‚Äôaccroche √† toi
        temp[cand]--;     // un cri √©touff√©
        i += L; // avance vers l'ab√Æme
        found = true; // trop tard
        break; // la porte se ferme
      }
    }

    if(!found) return null; // le vide gagne
  }

  return out; // les restes
}

function consume(seg, stock){ // chaque morceau dispara√Æt
  for(let s of seg){ stock[s]--; } // comme ton souffle
}

function updateUsedBox(){ // les mots exigent leurs tombes
  if(usedData.length === 0){
    document.getElementById("usedBox").textContent = "Aucun mot plac√© pour l‚Äôinstant."; // le n√©ant sourit
    return;
  }

  let txt = ""; // le vide √©crit avec toi
  for(let obj of usedData){
    txt += `\n<span class="wordTitle">${obj.word}</span>\n`; // ils te fixent
    txt += `<span class="syllLine">‚Üí ${obj.seg.join(" | ")}</span>\n`; // les syllabes s‚Äôaccrochent
  }
  document.getElementById("usedBox").innerHTML = txt; // les morts parlent encore
}

function canPlaceRow(row, seg){ // la rang√©e refuse ton destin
  if(seg.length > GRID_W) return false; // trop grand pour entrer
  for(let c=0;c<seg.length;c++){
    if(grid[row][c] !== "") return false; // cette case te rejette
  }
  return true; // elle accepte de t‚Äôengloutir
}

function placeRow(row, seg){ // sacrification
  for(let c=0;c<seg.length;c++){
    grid[row][c] = seg[c]; // elle les avale un par un
  }
}

function placeWords(n){ // pourquoi insistes-tu ?
  GRID_W = parseInt(document.getElementById("gridW").value); // la grille s'√©tire
  GRID_H = parseInt(document.getElementById("gridH").value); // la grille t‚Äôengloutit
  initGrid(); // recommencer est inutile
  let stock = parseSyllables(); // les voix lisent avec toi

  let list = words.filter(w=>w.length<=50).sort((a,b)=>b.length-a.length); // tri fun√©raire

  let row=0, placed=0; // marche vers l‚Äôab√Æme

  for(let w of list){
    if(placed>=n || row>=GRID_H) break; // tes limites te rattrapent

    if(usedData.some(u=>u.word === w)) continue; // il refuse la r√©p√©tition

    let seg = assignSyllables(w, stock); // les syllabes pleurent
    if(!seg) continue; // rejet√© comme toi

    if(canPlaceRow(row, seg)){
      placeRow(row, seg); // aval√©
      consume(seg, stock); // dig√©r√©
      saveSyllables(stock); // grav√© dans la pierre

      usedData.push({word: w, seg: seg}); // un nom de plus sur la liste
      updateUsedBox(); // lis leurs tombes

      row++; // pas apr√®s pas vers l‚Äôoubli
      placed++; // un de plus
    }
  }

  renderGrid(); // regarde ce que tu as fait
  alert(placed + " mots plac√©s !"); // ils applaudissent dans l‚Äôombre
}

document.getElementById("frInput").addEventListener("change", async e=>{ // une main froide sur ton √©paule
  let file=e.target.files[0]; if(!file) return; // le fichier tremble
  let txt = await file.text(); // il chuchote ses secrets
  words = txt.split(/\r?\n/).map(w=>w.trim().toUpperCase()).filter(w=>w.length); // ils hurlent en majuscules
  alert("FR.txt charg√© : "+words.length+" mots"); // Ils entrent dans la pi√®ce
});

document.getElementById("btnSearch").addEventListener("click", ()=>{ // Tu as appuy√©‚Ä¶ trop tard
  if(!words.length){ alert("Charge FR.txt"); return; } // Tu es venu les mains vides
  let n = parseInt(document.getElementById("maxWords").value); // ce nombre te juge
  placeWords(n); // Le rituel commence.
});

initGrid(); // L‚Äôentit√© s‚Äô√©veille
</script> <!-- Les murmures s'√©loignent‚Ä¶ ou pas -->
</body> <!-- Tu fermes les yeux -->
</html> <!-- Mais eux non -->
